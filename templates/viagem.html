<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Mission Log</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body class="conteudo-centralizado">
    <header class="brand-header">
        <img class="brand-logo" src="{{ url_for('static', filename='imagens/Group 3.png') }}" alt="Cosmo Casa logo" loading="lazy" decoding="async">
    </header>
    <div class="container-grande">
        <div class="mb-10">
            {% if session.get('missao_destino') and session.get('viagem_nave_id') %}
                <a href="{{ url_for('missao.selecao_modulos', destino=session.get('missao_destino'), nave_id=session.get('viagem_nave_id')) }}" class="botao">Back</a>
            {% else %}
                <a href="{{ url_for('tela_selecao') }}" class="botao">Back</a>
            {% endif %}
        </div>
        <h2>Mission Log</h2>
        {% set destino_en_map = {'lua': 'Moon', 'marte': 'Mars', 'exoplaneta': 'Exoplanet'} %}
        {% set destino_display = destino_en_map.get(destino.lower(), destino.capitalize()) %}
        <div class="info-nave">
            <span>Destination: <strong>{{ destino_display }}</strong></span>
            <span>Spacecraft: <strong>{{ nave.nome }}</strong></span>
        </div>

        <!-- SeÃ§Ã£o do DiÃ¡rio da MissÃ£o -->
        <div class="diario-section">
            <div class="diario-header" onclick="toggleDiario()">
                <h3>ðŸ“‹ Mission Events Log</h3>
                <span id="diario-toggle-icon">â–¼</span>
                <p class="diario-summary">Click to view detailed mission events ({{ diario|length }} events)</p>
            </div>
            
            <div class="diario-container" id="diario-container" style="display: none;">
                {% if diario %}
                    {% for evento_data in diario %}
                        <div class="diario-entrada">
                            <span class="turno">Turn {{ evento_data.turno }}</span>
                            <div class="evento">
                                {% if evento_data.evento.icone %}
                                    <img class="evento-icone" src="{{ url_for('missao.icons', filename=evento_data.evento.icone) }}" alt="Event icon">
                                {% endif %}
                                <h4>{{ evento_data.evento.nome }}</h4>
                                <p>{{ evento_data.evento.descricao }}</p>
                            </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <div class="diario-entrada">
                        <p>No events recorded for this mission.</p>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- Resultados da MissÃ£o -->
        <div id="resultado-final-container">
            <div class="sumario-chegada">
                <h3>Cargo Condition Upon Arrival</h3>
                <ul>
                {% for id, modulo in modulos.items() %}
                    <li>
                        {{ modulo.nome }} - 
                        {% if modulo.status == 'Avariado' %}
                            <strong class="status-avariado">DAMAGED</strong>
                        {% else %}
                            <strong class="status-ok">OPERATIONAL</strong>
                        {% endif %}
                    </li>
                {% endfor %}
                </ul>
            </div>
            
            <div class="resultado-viagem mt-16">
                {% if chegada_ok %}
                    <p><strong>Success:</strong> You reached the destination with the essential cargo. Score: <strong>{{ pontuacao }}</strong></p>
                    <a href="{{ url_for('missao.habitat') }}" class="botao">Build Habitat</a>
                {% else %}
                    <p><strong>Game Over:</strong> The mission did not reach the destination with sufficient conditions. Score: <strong>{{ pontuacao }}</strong></p>
                    <a href="{{ url_for('missao.game_over') }}" class="botao alerta">View Game Over Details</a>
                {% endif %}
            </div>
        </div>

    </div>

    <script>
        function toggleDiario() {
            const diarioContainer = document.getElementById("diario-container");
            const toggleIcon = document.getElementById("diario-toggle-icon");
            
            if (diarioContainer.style.display === "none" || diarioContainer.style.display === "") {
                // Expandir o diÃ¡rio
                diarioContainer.style.display = "block";
                toggleIcon.textContent = "â–²";
                
                // Scroll suave para o diÃ¡rio
                setTimeout(() => {
                    diarioContainer.scrollIntoView({ 
                        behavior: 'smooth', 
                        block: 'start' 
                    });
                }, 100);
            } else {
                // Colapsar o diÃ¡rio
                diarioContainer.style.display = "none";
                toggleIcon.textContent = "â–¼";
            }
        }

        // Adicionar estilos CSS seguindo o padrÃ£o do projeto (fundo preto, texto branco)
        document.addEventListener("DOMContentLoaded", function() {
            const style = document.createElement('style');
            style.textContent = `
                .diario-section {
                    margin: 20px 0;
                    border: 1px solid rgba(255, 255, 255, 0.1);
                    border-radius: 12px;
                    background: #000;
                    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
                }
                
                .diario-header {
                    padding: 20px;
                    cursor: pointer;
                    user-select: none;
                    display: flex;
                    align-items: center;
                    gap: 16px;
                    transition: background-color 0.2s ease;
                    border-radius: 12px 12px 0 0;
                }
                
                .diario-header:hover {
                    background: rgba(127, 181, 0, 0.1);
                }
                
                .diario-header h3 {
                    margin: 0;
                    flex: 1;
                    color: #fff;
                    font-family: 'Gotham Book', Arial, sans-serif;
                    font-size: 1.2rem;
                    font-weight: 600;
                }
                
                .diario-summary {
                    margin: 0;
                    color: rgba(255, 255, 255, 0.7);
                    font-size: 0.9em;
                    flex: 2;
                    font-family: 'Gotham Book', Arial, sans-serif;
                }
                
                #diario-toggle-icon {
                    font-size: 1.4em;
                    color: #7FB500;
                    transition: transform 0.2s ease;
                    font-weight: bold;
                }
                
                .diario-container {
                    border-top: 1px solid rgba(255, 255, 255, 0.1);
                    max-height: 400px;
                    overflow-y: auto;
                    padding: 20px;
                    background: #000;
                    border-radius: 0 0 12px 12px;
                }
                
                .diario-entrada {
                    margin-bottom: 16px;
                    padding: 16px;
                    background: rgba(255, 255, 255, 0.05);
                    border-radius: 8px;
                    border-left: 4px solid #7FB500;
                    border: 1px solid rgba(255, 255, 255, 0.1);
                    transition: transform 0.2s ease;
                }
                
                .diario-entrada:hover {
                    transform: translateY(-2px);
                    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
                }
                
                .turno {
                    font-weight: bold;
                    color: #7FB500;
                    font-size: 0.9em;
                    font-family: 'Gotham Book', Arial, sans-serif;
                    text-transform: uppercase;
                    letter-spacing: 0.5px;
                }
                
                .evento h4 {
                    margin: 8px 0 6px 0;
                    color: #fff;
                    font-family: 'Gotham Book', Arial, sans-serif;
                    font-size: 1.1em;
                    font-weight: 600;
                }
                
                .evento p {
                    margin: 6px 0 0 0;
                    color: rgba(255, 255, 255, 0.8);
                    line-height: 1.5;
                    font-family: 'Gotham Book', Arial, sans-serif;
                }
                
                .evento-icone {
                    width: 28px;
                    height: 28px;
                    float: left;
                    margin-right: 12px;
                    margin-top: 4px;
                    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
                }
                
                /* Scrollbar personalizada para seguir o tema */
                .diario-container::-webkit-scrollbar {
                    width: 8px;
                }
                
                .diario-container::-webkit-scrollbar-track {
                    background: rgba(255, 255, 255, 0.1);
                    border-radius: 4px;
                }
                
                .diario-container::-webkit-scrollbar-thumb {
                    background: #7FB500;
                    border-radius: 4px;
                }
                
                .diario-container::-webkit-scrollbar-thumb:hover {
                    background: rgba(127, 181, 0, 0.8);
                }
            `;
            document.head.appendChild(style);
        });
    </script>
</body>
</html>